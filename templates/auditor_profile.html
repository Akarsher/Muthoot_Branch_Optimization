<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Auditor Profile</title>
  <style>
    /* Compact red-themed profile styling, aligned layout, remove extra boxes */
    :root{
      --accent:#c62828;
      --accent-600:#b71c1c;
      --muted:#666;
      --card-bg:#fff;
    }

    body{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin:0;
      background: #fff5f5;
      color:#111;
    }

    .page-wrapper{
      padding: 92px 16px 40px;
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }

    .card{
      width:100%;
      max-width:800px;
      background:var(--card-bg);
      border-radius:10px;
      padding:18px;
      box-shadow:0 6px 18px rgba(198,40,40,0.06);
      border-left:4px solid var(--accent);
      box-sizing:border-box;
      position:relative; /* allow fine control if needed */
    }

    .card h2{
      margin:0 0 8px 0;
      color:var(--accent-600);
      font-size:1.25rem;
    }

    .profile-section{
      display:flex;
      gap:20px;
      align-items:flex-start; /* avatar aligned from top; avatar will be nudged down */
      flex-wrap:wrap;
    }

    .avatar-container{
      flex:0 0 160px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      margin-top:18px; /* push avatar a bit down */
    }

    .avatar{
      width:120px;
      height:120px;
      border-radius:50%;
      object-fit:cover;
      border:3px solid rgba(198,40,40,0.12);
    }

    .edit-icon{ top:-30px; left:6px; }
    input[type="file"]{ display:none; }

    /* Form layout: use grid for consistent label/input alignment */
    .details{ flex:1; display:block; }

    .form-grid {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 12px 18px;
      align-items: center;
      width: 100%;
    }

    .row { display: contents; } /* keep markup compatibility */

    .label {
      justify-self: end;
      text-align: right;
      color: var(--muted);
      font-weight: 600;
      font-size: 0.95rem;
      padding-right: 6px;
    }

    .value {
      justify-self: start;
      width: 100%;
    }

    /* Inputs: consistent height/appearance */
    .value input[type="text"],
    .value input[type="email"],
    .value input[type="tel"]{
      width:100%;
      height:40px;
      padding:8px 12px;
      border:1px solid #e6e6e6;
      border-radius:8px;
      background:#fff;
      box-shadow:none;
      outline:none;
      font-size:0.97rem;
      box-sizing:border-box;
    }
    .value input:focus{ border-color:var(--accent); box-shadow:0 6px 18px rgba(198,40,40,0.06); }

    /* Actions/buttons: right aligned, identical size and baseline aligned */
    .actions{
      display:flex;
      gap:12px;
      justify-content:flex-end;
      align-items:center;
      width:100%;
      margin-top:10px;
      padding-top:6px;
      box-sizing:border-box;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:10px 14px;
      height:44px;
      width:160px;          /* fixed equal width for both buttons */
      border-radius:8px;
      font-weight:600;
      border:0;
      cursor:pointer;
      text-decoration:none;
      line-height:1;
      box-sizing:border-box;
      margin:0;
      background-clip:padding-box;
      vertical-align:middle;
    }

    .btn-primary{
      background:var(--accent);
      color:#fff;
      border:1px solid rgba(0,0,0,0.02);
    }

    .btn-secondary{
      background:transparent;
      color:var(--accent-600);
      border:1px solid rgba(198,40,40,0.08);
    }

    @media (max-width:420px){
      .actions{ flex-direction:column-reverse; gap:8px; align-items:stretch; }
      .btn{ width:100%; }
    }

    .error{ color:#b00020; font-size:0.85rem; margin-top:6px; display:block; }

    /* Responsive: switch to stacked layout on small screens */
    @media (max-width:720px){
      .form-grid{
        grid-template-columns: 1fr;
        gap:8px 8px;
      }
      .label{ justify-self: start; text-align:left; padding-right:0; }
      .page-wrapper{ padding-top: 120px; }
      .profile-section { flex-direction: column; gap:14px; align-items:center; }
      .details { width:100%; }
      .row { flex-direction: column; align-items:flex-start; gap:6px; }
      .label { text-align:left; width:100%; }
      .avatar { width:120px; height:120px; }
      .card { padding:20px; }
    }
  </style>
</head>
<body>
  {% include '_navbar.html' %}
  <div class="page-wrapper">
    <div class="card">
     <h2>Auditor Profile</h2>
 
     <form id="profileForm" method="post" enctype="multipart/form-data" novalidate>
       <div class="profile-section">
         <div class="avatar-container">
           {% set avatar_path = user.get('avatar') %}
           {% set avatar_url = url_for('static', filename=avatar_path) if avatar_path else url_for('static', filename='images/user.png') %}
           <img id="avatarPreview" src="{{ avatar_url }}" class="avatar" alt="avatar">
           <div class="edit-icon" id="editIcon" title="Change picture">✏️</div>
           <input id="avatar" name="avatar" type="file" accept="image/*">
         </div>
 
         <div class="details">
           <div class="form-grid">
             <div class="label">Username:</div>
             <div class="value">{{ user.get('username','') }}</div>
 
             <div class="label">Full name:</div>
             <div class="value">
               <input id="name" name="name" type="text" value="{{ user.get('name','') }}">
             </div>
 
             <div class="label">Email:</div>
             <div class="value">
               <input id="email" name="email" type="email" value="{{ user.get('email','') }}">
             </div>
 
             <div class="label">Phone:</div>
             <div class="value">
               <input id="phone" name="phone" type="tel" value="{{ user.get('phone','') }}">
             </div>
 
             <div class="label">Role:</div>
             <div class="value">{{ user.get('role','auditor') }}</div>
           </div>
         </div>
       </div>
 
       <div class="actions" role="group" aria-label="Profile actions">
         <!-- Back button removed -->
         <button type="submit" class="btn btn-primary">Save Profile</button>
        </div>
     </form>
    </div>
  </div>
 
 <script>
   const avatarInput = document.getElementById('avatar');
   const avatarPreview = document.getElementById('avatarPreview');
   const editIcon = document.getElementById('editIcon');
   const form = document.getElementById('profileForm');
 
   // Preview avatar image before upload
   editIcon.addEventListener('click', () => {
     avatarInput.click();
   });
 
   avatarInput.addEventListener('change', () => {
     const file = avatarInput.files[0];
     if (file) {
       const reader = new FileReader();
       reader.onload = () => {
         avatarPreview.src = reader.result;
       }
       reader.readAsDataURL(file);
     }
   });
 
   // Form validation
   form.addEventListener('submit', (e) => {
     let isValid = true;
     e.preventDefault();
 
     // Clear previous errors
     document.querySelectorAll('.error').forEach(el => el.textContent = '');
 
     // Validate name
     const name = form.name.value.trim();
     if (!name) {
       isValid = false;
       document.getElementById('nameError').textContent = 'Name is required';
     }
 
     // Validate email
     const email = form.email.value.trim();
     if (!email) {
       isValid = false;
       document.getElementById('emailError').textContent = 'Email is required';
     } else if (!/\S+@\S+\.\S+/.test(email)) {
       isValid = false;
       document.getElementById('emailError').textContent = 'Email is invalid';
     }
 
     // Validate phone
     const phone = form.phone.value.trim();
     if (!phone) {
       isValid = false;
       document.getElementById('phoneError').textContent = 'Phone number is required';
     }
 
     if (isValid) {
       form.submit();
     }
   });
 </script>
 </body>
 </html>
